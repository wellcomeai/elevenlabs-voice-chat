# render.yaml - ElevenLabs Conversational AI Python (Fixed)
# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ Render.com

services:
  # –û—Å–Ω–æ–≤–Ω–æ–π –≤–µ–±-—Å–µ—Ä–≤–∏—Å (–ë–ï–ó PyAudio)
  - type: web
    name: elevenlabs-python-cloud
    runtime: python3
    plan: starter
    
    # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —Å–±–æ—Ä–∫–∏
    buildCommand: |
      pip install --upgrade pip && 
      pip install -r requirements-render.txt
    
    # –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ –≤–µ–±-–≤–µ—Ä—Å–∏–∏
    startCommand: python main_render.py
    
    # Health check
    healthCheckPath: /health
    
    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    envVars:
      - key: ELEVENLABS_API_KEY
        sync: false  # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —á–µ—Ä–µ–∑ Render Dashboard
      - key: ELEVENLABS_AGENT_ID
        sync: false  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
      - key: PYTHON_VERSION
        value: "3.11"
      - key: LOG_LEVEL
        value: "INFO"
      - key: PORT
        value: "10000"
      - key: DEBUG
        value: "false"
    
    # –†–µ—Å—É—Ä—Å—ã
    disk:
      name: elevenlabs-data
      mountPath: /app/data
      sizeGB: 1
    
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
    autoDeploy: true

  # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)
  - type: background
    name: elevenlabs-background-worker
    runtime: python3
    plan: starter
    
    buildCommand: |
      pip install --upgrade pip && 
      pip install -r requirements-render.txt
    
    # –§–æ–Ω–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä (–±–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
    startCommand: |
      python -c "
      import asyncio
      import time
      import logging
      from websocket_client import ElevenLabsWebSocketClient
      from config import Config
      
      logging.basicConfig(level=logging.INFO)
      logger = logging.getLogger(__name__)
      
      async def background_worker():
          logger.info('üîÑ –§–æ–Ω–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä –∑–∞–ø—É—â–µ–Ω')
          config = Config()
          
          while True:
              try:
                  # –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                  client = ElevenLabsWebSocketClient(config.ELEVENLABS_API_KEY, config.ELEVENLABS_AGENT_ID, None)
                  result = await client.connect()
                  
                  if result:
                      logger.info('‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å ElevenLabs –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ')
                      await client.disconnect()
                  else:
                      logger.warning('‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º')
                  
                  await asyncio.sleep(300)  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
                  
              except Exception as e:
                  logger.error(f'‚ùå –û—à–∏–±–∫–∞ –≤–æ—Ä–∫–µ—Ä–∞: {e}')
                  await asyncio.sleep(60)
      
      asyncio.run(background_worker())
      "
    
    envVars:
      - key: ELEVENLABS_API_KEY
        sync: false
      - key: ELEVENLABS_AGENT_ID
        sync: false
      - key: LOG_LEVEL
        value: "INFO"
    
    # –ù–µ –∑–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    autoDeploy: false

# ===== –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –ò–ù–°–¢–†–£–ö–¶–ò–ò =====
#
# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
# 1. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è requirements-render.txt –ë–ï–ó PyAudio
# 2. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è main_render.py —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
# 3. –£–±—Ä–∞–Ω—ã —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–Ω–µ –Ω—É–∂–Ω—ã –±–µ–∑ PyAudio)
# 4. –î–æ–±–∞–≤–ª–µ–Ω –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
#
# üöÄ –ö–û–ú–ê–ù–î–´ –î–õ–Ø RENDER:
# Build Command: pip install --upgrade pip && pip install -r requirements-render.txt
# Start Command: python main_render.py
# Environment Variables: ELEVENLABS_API_KEY=your_key
#
# üåê –í–û–ó–ú–û–ñ–ù–û–°–¢–ò –û–ë–õ–ê–ß–ù–û–ô –í–ï–†–°–ò–ò:
# ‚úÖ REST API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
# ‚úÖ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è  
# ‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—Ç–∞—Ç—É—Å–∞
# ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞
# ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ElevenLabs API
# ‚ùå –ê—É–¥–∏–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ)
#
# üéØ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
# - –û—Ç–∫—Ä–æ–π—Ç–µ URL Render —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
# - /health - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
# - /api/stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞  
# - /api/test-connection - —Ç–µ—Å—Ç ElevenLabs
# - /ws - WebSocket –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
#
# üí° –î–õ–Ø –ü–û–õ–ù–û–ì–û –§–£–ù–ö–¶–ò–û–ù–ê–õ–ê:
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é —Å PyAudio:
# pip install -r requirements.txt
# python run.py
